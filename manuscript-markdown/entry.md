# ログをはじめて可視化する方たちへ

世の中にはたくさんのログがあり、いろんなかたちで携わっている方がいるのではないでしょうか。  
例えば、Webサービスのログから分析用途として使用したり、障害対応でログの調査を行ったり、様々あるかと思います。  
ログになんらかで携わったことがある人は、一度は面倒な作業だと思ったことはないでしょうか（僕はありますw）  
分析する場面までいければまだいいです。  
でも、現実は、まずログ自体の取得が非常に大変です。  
サーバが1台ならいいのですが、数十台になってきたら、ツラミでしかないです。  
あくまで一例ですが、どのような流れでログを取得して分析するまでやっているか見ていきたいと思います。

## ログ取得から分析までの流れ

仮にWebサーバ(Nginx)を4台運用しているとします。  
日々のアクセス状況を見たいため、access.logを取得したいと考えます。  

1. Webサーバにアクセスし、access.logをscpで取得します
2. Webサーバが4台あるため、1を4回繰り返します
3. 取得したaccess.logをマージします
4. マージしたログをExcelに展開します
5. Excelに展開したログを分析できるようレコードをカラム単位に分割できるよう加工します
6. やっと分析を開始できます

さて、どうでしょうか。  
あえてExcelで分析する前提でやりましたが、かなりの工数がかかることがわかるのではないでしょうか？  

いやいや、自動化できるところあるでしょ！って思う人もいると思います。  
たしかにシェル芸人の方やVBを駆使できる方がいれば可能です。  
ただ、取り込む際にバッチ処理で施すものなら、ログの鮮度は落ちてしまいます。  

では、もっと楽に取り込めて、ニアリアルタイムで分析できるログ基盤を構築することはできないのか。  
結論から言うと、できます。  
Elastic Stackを活用することで、これらを実現することができます。  



このツラミな作業、

ログを見るのは職人技と

みなさんログは好きですか？  
今までたくさんのログを見てこられた方は多くいるのではないでしょうか。  
そして、多くの苦労を伴ってきたのではないでしょうか。  
これからエンジニアとなり、ログと向き合うことになる方もいるかと思います。  
そんな方々へ、少しでもログの楽しさが伝われば嬉しいなと思ってます。  

## こんな流れで話すよ

それでは、ここから具体的にどんな内容について書いてあるのかざっくり書くと、ログの取込方法や、多種多様なログフォーマットに合わせたフィルターの書き方などについてです。

1. 使用するプロダクトや環境について
3. Logstashを使ってみる
3. Beatsという便利なデータシッパーを使ってみる
4. まとめ

## 使用するプロダクトと実行環境について

Elasticsearch社が提供するElastic Stackを利用します。  
以下のプロダクトを利用してログの世界に触れていきたいと思います。

* Elasticsearch 6.2.2
* Logstash 6.2.2
* Kibana 6.2.2
* Metricbeat 6.2.2
* Auditbeat 6.2.2
* Packetbeat 6.2.2

> Download Elastic Stack  
> https://www.elastic.co/jp/products

簡単にこれらのプロダクトについて紹介します。

### Elasticsearch

Elasticsaerchは、オープンソースの分散型RESTfull検索/分析エンジンです。  
今回、Logstashのストア先として利用します。

### Logstash

Logstashは、オープンソースログ収集管理ツールです。  
取り込み先としては、検索エンジンのElasticsearchと組み合わせることでニアリアルタイムにログを取り込むことができます。

### kibana

Kibanaは、オープンソースのビジュアライズツールです。  
Elasticserchのデータをビジュアライズします。

### Beats

Beatsは、様々な用途に合わせてデータを容易に送ることができるオープンソースの軽量データシッパーです。  
Beatsファミリーとして、以下があります。

* Filebeat
* Metricbeat
* Packetbeat
* Winlogbeat
* Auditbeat
* Heartbeat

### Elastic Stackを動かす実行環境

* Amazon Linux AMI 2017.09.1 (HVM), SSD Volume Type - ami-97785bed
* t2.medium
  - vCPU: 2
  - Mem: 4





